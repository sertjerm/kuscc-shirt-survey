// ===================================================================
// File: src/services/shirtApi.js
// Description: Service layer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÄ‡∏™‡∏∑‡πâ‡∏≠ + Mapping Data
// ===================================================================

import axios from "axios";
import { REAL_API_BASE_URL, SIZE_ORDER } from "../utils/constants";

export const api = axios.create({
  baseURL: REAL_API_BASE_URL,
  withCredentials: true,
  headers: {
    "Content-Type": "application/json; charset=utf-8",
  },
  timeout: 15000,
  maxBodyLength: Infinity,
});

// Parse WCF Date: /Date(1758602879000+0700)/
const parseWcfDate = (dateString) => {
  if (!dateString) return null;
  const match = String(dateString).match(/\/Date\((\d+)\+/);
  return match ? new Date(Number(match[1])) : null;
};

// Format member data from API
const formatMemberData = (apiData) => {
  if (!apiData) return null;

  return {
    memberCode: apiData.MEMB_CODE,
    fullName: apiData.FULLNAME,
    displayName: apiData.DISPLAYNAME,
    phone: apiData.MEMB_MOBILE,
    socialId: apiData.MEMB_SOCID,
    sizeCode: apiData.SIZE_CODE,
    surveyDate: parseWcfDate(apiData.SURVEY_DATE),
    surveyMethod: apiData.SURVEY_METHOD,
    processedBy: apiData.PROCESSED_BY,
    receiverName: apiData.RECEIVER_NAME,
    receiverType: apiData.RECEIVER_TYPE,
    receiveDate: parseWcfDate(apiData.RECEIVE_DATE),
    receiveStatus: apiData.RECEIVE_STATUS,
    remarks: apiData.REMARKS,
    updatedDate: parseWcfDate(apiData.UPDATED_DATE),
    userRole: apiData.USER_ROLE,
    hasReceived: apiData.RECEIVE_STATUS === "RECEIVED",
  };
};

export const loginMember = async ({ memberCode, phone, idCard }) => {
  const payload = { mbcode: memberCode, socid: idCard, mobile: phone };
  console.log("Login payload:", payload);

  const res = await api.post("/ShirtSurveyLogin", payload);

  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å");
  }

  const memberData = formatMemberData(res.data.data);

  const loginResult = {
    ...memberData,
    round: memberData.socialId ? memberData.socialId.split("-").pop() : idCard,
    name:
      memberData.displayName || memberData.fullName || memberData.memberCode,
  };

  console.log("Login successful, member data:", loginResult);
  return loginResult;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô saveMemberSize ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏™‡∏∑‡πâ‡∏≠
export const saveMemberSize = async ({
  memberCode,
  sizeCode,
  remarks = "",
  surveyMethod = "ONLINE",
  processedBy = null,
}) => {
  const paddedMemberCode = (memberCode ?? "").toString().padStart(6, "0");
  const payload = {
    MEMB_CODE: paddedMemberCode,
    SIZE_CODE: sizeCode,
    SURVEY_METHOD: surveyMethod,
    REMARKS: remarks,
  };

  if (processedBy) {
    const paddedProcessedBy = processedBy.toString().padStart(6, "0");
    payload.PROCESSED_BY = paddedProcessedBy;
  }

  console.log("Saving size payload:", payload);

  const res = await api.post("/AddShirtSurvey", payload);
  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }

  console.log("Save size response:", res.data);
  return res.data;
};

export const SearchMember = async (mbcode) => {
  const res = await api.get(
    `/SearchShirtMember?mbcode=${encodeURIComponent(mbcode)}`
  );

  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å");
  }
  return formatMemberData(res.data.data);
};

export const getShirtMemberListPaged = async ({
  page = 1,
  pageSize = 20,
  search = "",
  status = "",
  size_code = "",
  sort_field = "",
  sort_order = "asc",
}) => {
  const params = new URLSearchParams({
    page: page.toString(),
    pageSize: pageSize.toString(),
    search: search || "",
    status: status || "",
    size_code: size_code || "",
    sort_field: sort_field || "",
    sort_order: sort_order || "asc",
  });

  console.log("API Request params:", {
    page,
    pageSize,
    search,
    status,
    size_code,
    sort_field,
    sort_order,
  });

  const res = await api.get(`/GetShirtMemberListPaged?${params.toString()}`);
  if (res.data?.responseCode !== 200 && res.data?.responseCode !== 404) {
    throw new Error(res.data?.responseMessage || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
  }

  const data = res.data.data || [];
  const formattedData = Array.isArray(data) ? data.map(formatMemberData) : [];

  console.log("API Response:", {
    totalCount: res.data.totalCount,
    dataLength: formattedData.length,
  });

  return {
    data: formattedData,
    totalCount: res.data.totalCount || 0,
    currentPage: res.data.currentPage || page,
    pageSize: res.data.pageSize || pageSize,
    totalPages: res.data.totalPages || 1,
  };
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô submitPickup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠
export const submitPickup = async ({
  memberCode,
  sizeCode,
  processedBy,
  receiverType = "SELF",
  receiverName = null,
  remarks = "",
}) => {
  const paddedMemberCode = (memberCode ?? "").toString().padStart(6, "0");
  const paddedProcessedBy = (processedBy ?? "").toString().padStart(6, "0");

  const payload = {
    MEMB_CODE: paddedMemberCode,
    SIZE_CODE: sizeCode,
    SURVEY_METHOD: "MANUAL",
    RECEIVE_STATUS: "RECEIVED",
    RECEIVER_TYPE: receiverType,
    PROCESSED_BY: paddedProcessedBy,
    RECEIVER_NAME: receiverName,
    REMARKS: remarks || "",
  };

  console.log("Submit pickup payload:", payload);

  const res = await api.post("/AddShirtSurvey", payload);
  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }

  console.log("Submit pickup response:", res.data);
  return res.data;
};

// ‚úÖ Helper: Normalize inventory items
export const formatInventoryData = (apiData = []) => {
  return Array.isArray(apiData)
    ? apiData.map((item) => ({
        sizeCode: item.SIZE_CODE,
        produced: Number(item.PRODUCED_QTY) || 0,
        reserved: Number(item.RESERVED_QTY) || 0,
        received: Number(item.RECEIVED_QTY) || 0, // ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Number
        distributed: Number(item.DISTRIBUTED_QTY) || 0,
        remaining: Number(item.REMAINING_QTY) || 0,
        isLowStock: String(item.IS_LOW_STOCK).toUpperCase() === "Y",
        remarks: item.REMARKS || "",
        updatedBy: item.UPDATED_BY || null,
        updatedDate: parseWcfDate(item.UPDATED_DATE) || null,
        createdDate: parseWcfDate(item.CREATED_DATE) || null,
        stockId: item.STOCK_ID || null,
      }))
    : [];
};

// ‚úÖ API: GetStockSummary ‚Üí ‡πÉ‡∏ä‡πâ formatInventoryData
export const getInventorySummary = async () => {
  const res = await api.get("/GetStockSummary");
  if (res.data?.responseCode !== 200) {
    throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏î‡πâ");
  }

  const stockData = res.data.data || [];
  const inventorySummary = formatInventoryData(stockData);
  console.log("Raw inventory data:", stockData);
  console.log("Formatted inventory data:", inventorySummary);

  inventorySummary.sort(
    (a, b) => SIZE_ORDER.indexOf(a.sizeCode) - SIZE_ORDER.indexOf(b.sizeCode)
  );
  return inventorySummary;
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°/‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å
export const addStock = async ({
  sizeCode,
  quantity,
  remarks,
  processedBy,
}) => {
  const payload = {
    size_code: sizeCode,
    produced_delta: quantity,
    remarks: remarks || "",
    updated_by: processedBy,
  };
  const res = await api.post("/UpdateStock", payload);
  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
  return res.data;
};

export const removeStock = async ({
  sizeCode,
  quantity,
  remarks,
  processedBy,
}) => {
  const payload = {
    size_code: sizeCode,
    distributed_delta: quantity,
    remarks: remarks || "",
    updated_by: processedBy,
  };
  const res = await api.post("/UpdateStock", payload);
  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
  return res.data;
};

export const adjustInventory = async (adjustmentData) => {
  if (adjustmentData.type === "ADD") {
    return addStock(adjustmentData);
  } else if (adjustmentData.type === "REMOVE") {
    return removeStock(adjustmentData);
  } else {
    throw new Error("ADJUSTMENT_TYPE ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô 'ADD' ‡∏´‡∏£‡∏∑‡∏≠ 'REMOVE' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
  }
};
// ‚úÖ NEW: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏ï‡∏≤‡∏° API spec ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
export const clearMemberData = async ({
  memberCode,
  clearSize = true,
  clearReceiveStatus = true,
  clearRemarks = true,
  clearedBy,
}) => {
  const paddedMemberCode = (memberCode ?? "").toString().padStart(6, "0");
  const paddedClearedBy = (clearedBy ?? "").toString().padStart(6, "0");

  // ‚ö†Ô∏è ‡∏ï‡∏≤‡∏° API spec: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå REMARKS ‡πÉ‡∏ô payload
  // API ‡∏à‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° boolean flags ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const payload = {
    MEMB_CODE: paddedMemberCode,
    ClearSize: clearSize,
    ClearReceiveStatus: clearReceiveStatus,
    ClearRemarks: clearRemarks,
    CLEARED_BY: paddedClearedBy,
  };

  console.log("Clear member data payload:", payload);

  const res = await api.post("/ClearShirtSurvey", payload);

  if (res.data?.responseCode !== 200) {
    throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
  }

  console.log("Clear member data response:", res.data);
  return res.data;
};
// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard Stats
export const getDashboardStats = async () => {
  try {
    console.log("üìä Fetching dashboard stats from API...");

    const res = await api.get("/GetDashboardStats");

    if (res.data?.responseCode !== 200) {
      throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ");
    }

    const stats = res.data.data;

    console.log("üìä Dashboard Stats received:", stats);
    return stats;
  } catch (error) {
    console.error("‚ùå Error fetching dashboard stats:", error);
    throw error;
  }
};

// ===================================================================
// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô shirtApi.js
// ===================================================================

// Format stock log data
const formatStockLogData = (apiData) => {
  if (!apiData) return null;

  return {
    logId: apiData.LOG_ID,
    sizeCode: apiData.SIZE_CODE,
    actionType: apiData.ACTION_TYPE,
    producedDelta: Number(apiData.PRODUCED_DELTA) || 0,
    distributedDelta: Number(apiData.DISTRIBUTED_DELTA) || 0,
    quantityBefore: Number(apiData.QUANTITY_BEFORE) || 0,
    quantityAfter: Number(apiData.QUANTITY_AFTER) || 0,
    remarks: apiData.REMARKS || "",
    processedBy: apiData.PROCESSED_BY || "",
    createdDate: parseWcfDate(apiData.CREATED_DATE),
  };
};

// ‚úÖ API: Get Stock Logs (Simple, ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö parameters)
export const getStockLogs = async () => {
  console.log("üîç Fetching all stock logs...");

  const res = await api.get("/GetStockLogs");

  if (res.data?.responseCode !== 200 && res.data?.responseCode !== 404) {
    throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ");
  }

  const data = res.data.data || [];
  const formattedData = Array.isArray(data) ? data.map(formatStockLogData) : [];

  console.log("üìã Stock logs loaded:", formattedData.length, "records");

  return formattedData;
};

export { formatMemberData, parseWcfDate, formatStockLogData };

// ===================================================================
// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
// ===================================================================

/**
 * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
 * @returns {Promise<Array>} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
 */
export const getDepartmentReport = async () => {
  try {
    console.log("üìä Fetching department report from API...");

    // ‚úÖ ‡πÉ‡∏ä‡πâ endpoint ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    const res = await api.get("/GetShirtResultDeptSect");

    if (res.data?.responseCode !== 200) {
      throw new Error(res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ");
    }

    const data = res.data.data || [];
    console.log("üìä Department report data received:", data);

    return data;
  } catch (error) {
    console.error("‚ùå Error fetching department report:", error);

    // ‚úÖ ‡∏ñ‡πâ‡∏≤ API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° (404) ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    if (error.response?.status === 404 || error.message.includes("404")) {
      console.warn("‚ö†Ô∏è API endpoint not available, returning sample data");

      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏î‡πâ
      const sampleData = [
        {
          CNT: 1,
          DEPT_CODE: "001",
          DEPT_NAME: "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
          SECT_CODE: "000",
          SECT_NAME: "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
          SIZE_CODE: "3XL",
        },
        {
          CNT: 3,
          DEPT_CODE: "001",
          DEPT_NAME: "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
          SECT_CODE: "002",
          SECT_NAME: "‡∏Å‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå",
          SIZE_CODE: "2XL",
        },
        {
          CNT: 2,
          DEPT_CODE: "001",
          DEPT_NAME: "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
          SECT_CODE: "006",
          SECT_NAME: "‡∏Å‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
          SIZE_CODE: "L",
        },
        {
          CNT: 4,
          DEPT_CODE: "002",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "000",
          SECT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SIZE_CODE: "M",
        },
        {
          CNT: 1,
          DEPT_CODE: "002",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "001",
          SECT_NAME: "‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SIZE_CODE: "S",
        },
        {
          CNT: 5,
          DEPT_CODE: "002",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "002",
          SECT_NAME: "‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå",
          SIZE_CODE: "XL",
        },
        {
          CNT: 3,
          DEPT_CODE: "003",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "000",
          SECT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SIZE_CODE: "L",
        },
        {
          CNT: 2,
          DEPT_CODE: "003",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "001",
          SECT_NAME: "‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå",
          SIZE_CODE: "M",
        },
        {
          CNT: 4,
          DEPT_CODE: "003",
          DEPT_NAME: "‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
          SECT_CODE: "002",
          SECT_NAME: "‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏ü‡∏ü‡πâ‡∏≤",
          SIZE_CODE: "XL",
        },
      ];

      return sampleData;
    }

    throw error;
  }
};

/**
 * Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô Excel
 * @returns {Promise<Blob>} ‡πÑ‡∏ü‡∏•‡πå Excel
 */
export const exportDepartmentReport = async () => {
  try {
    console.log("üìä Exporting department report to Excel...");

    const res = await api.get("/ExportDepartmentReport", {
      responseType: "blob",
    });

    if (!res.data || res.data.size === 0) {
      throw new Error("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö export");
    }

    console.log("üìä Excel file exported successfully");
    return res.data;
  } catch (error) {
    console.error("‚ùå Error exporting department report:", error);

    // ‡∏ñ‡πâ‡∏≤ API ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡πÉ‡∏´‡πâ throw error ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
    throw new Error(
      error.response?.data?.message ||
        error.message ||
        "‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Export Excel ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
    );
  }
};

// ===================================================================
// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
// ===================================================================

/**
 * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î
 * @returns {Promise<Array>} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î
 */
export const getSizeReport = async () => {
  try {
    const res = await api.get("/GetSizeReport");

    if (res.data?.responseCode !== 200) {
      throw new Error(
        res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏î‡πâ"
      );
    }

    return res.data.data || [];
  } catch (error) {
    console.error("‚ùå Error fetching size report:", error);
    throw error;
  }
};

/**
 * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠
 * @returns {Promise<Array>} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
 */
export const getReceiveStatusReport = async () => {
  try {
    const res = await api.get("/GetReceiveStatusReport");

    if (res.data?.responseCode !== 200) {
      throw new Error(
        res.data?.responseMessage || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ"
      );
    }

    return res.data.data || [];
  } catch (error) {
    console.error("‚ùå Error fetching receive status report:", error);
    throw error;
  }
};

/**
 * Export ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á
 * @param {string} reportType - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ('department', 'size', 'status')
 * @param {Object} options - ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
 * @returns {Promise<Blob>} ‡πÑ‡∏ü‡∏•‡πå Excel
 */
export const exportCustomReport = async (
  reportType = "department",
  options = {}
) => {
  try {
    const params = new URLSearchParams({
      type: reportType,
      ...options,
    });

    const res = await api.get(`/ExportCustomReport?${params.toString()}`, {
      responseType: "blob",
    });

    if (!res.data || res.data.size === 0) {
      throw new Error("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö export");
    }

    return res.data;
  } catch (error) {
    console.error("‚ùå Error exporting custom report:", error);
    throw error;
  }
};
